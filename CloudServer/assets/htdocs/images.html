<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang="en">
<html>
	
	<head>
		<!-- Info-->
		<title>	Cloud Server Developers Image Service Page </title>
		<meta charset="UTF-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"> 
		<meta name="viewport" content="width=device-width, initial-scale=1.0">  <meta name="viewport" content="width=device-width, initial-scale=1.0"> 
		<meta name="description" content="Services List" />
		<meta name="keywords" content="map, navigation, C++, services, web, transcoding, images" />
		<meta name="author" content="CF2011" />
		<meta http-equiv="content-type" content="text/html; charset=UTF-8">
		<!--<meta http-equiv="imagetoolbar" content="no" /> -->
		
		<!-- End Of Info-->
		
		<!-- Public CSS-->
		<link rel="stylesheet" href="css/grumble.min.css">
		<link rel="stylesheet" type="text/css" href="js/fancybox/jquery.fancybox-1.3.4.css" media="screen" />
		<!-- End Of CSS-->
				
		<!-- CF CSS -->
		<!--[if gte IE 9]>
			  <style type="text/css">
				.gradient {
					filter: none;
				}
			  </style>
		<![endif]-->
		<link rel="stylesheet" href="css/cf.css">
		<link rel="stylesheet" href="css/cf.head.panel.css">
		<!-- End of CF CSS-->
		
		<!-- Public JS-->
		<script type="text/javascript" src="js/jquery-1.7.1.min.js">								
		</script>
		
		<script type="text/javascript" src="js/jquery.sha256.min.js">								
		</script>
		
		<script type="text/javascript" src="js/jquery.validate.min.js">								
		</script>
		
		<script type="text/javascript" src="js/tempo.min.js">									
		</script>
		
		<script type="text/javascript" src="http://www.google.com/recaptcha/api/js/recaptcha_ajax.js">
		</script>
		
		<script type = 'text/javascript'src = "js/jquery.grumble.min.js" >
		</script>
		
		<script type='text/javascript' src="js/jquery.event.drag-1.5.min.js">
		</script>

		<script src="js/jquery.grumble.min.js">
		</script>
		
		<script type="text/javascript" src="js/fancybox/jquery.mousewheel-3.0.6.pack.js"></script>
		<script type="text/javascript" src="js/fancybox/jquery.fancybox-1.3.4.pack.js"></script>
	
		<!-- End Of Public JS-->
		
		<!-- CF JS -->
		<script type='text/javascript' src="js/cf.js"></script>
		
		<script type="text/javascript" src="js/cf.windows.js"></script>
		
		<script type="text/javascript" src="js/cf.head.panel.js"></script>
		
		<script type="text/javascript" src="js/cf.windows.login_and_register.js"></script>
		
		<script type="text/javascript" src="js/cf.user.js"></script>
		
		<script type="text/javascript" src="js/cf.windows.ufs.file.js"></script>
		
		<!-- End Of CF JS-->
		
	<script>
		
		var page_url = "http://" + location.host + "/";
		
		function showBox(images, ind)
		{
				$.fancybox(images
					, 
					{
					'index'				: ind ,
					'cyclic'			: 'true',
					'transitionIn'		: 'fade',
					'transitionOut'		: 'fade',
					'titlePosition' 	: 'over',
					'type'              : 'image',
					'titleFormat'		: function(title, currentArray, currentIndex, currentOpts) {
						
						return '<span id="fancybox-title-over">Image ' + (currentIndex + 1) + ' / ' + currentArray.length + (title.length ? ' &nbsp; ' + title : '') + '</span>';
					},
					'onComplete'	:	function() {
						document.title = "" + this.title + " proudly Brought To You By CF Images Rendering Service";
						window.location.hash = this.extra_href;
						$("#fancybox-wrap").hover(function() {
							$("#fancybox-title").show();
						}, function() {
							$("#fancybox-title").hide();
						});
					},
					'onClosed' 		: function() {
						document.title = "Cloud Server Developers Image Service Page";
						window.location.hash = "";
						
					}
					
					
				});
		}
		
		function parseArrayForBox(JSON, images)
		{
			$.each(JSON, function(index, value) {

				if(value.is_public == 1)
				{
					//value.href = ;
					value.real_href =  page_url +  "image_renderer.service?action=resize&from_format=" + value.type + "&from_url=" +page_url + value.href + "&to_format=jpg&w="+ screen.width 	+"&h=" + screen.height;
					
				}
				else
				{
					value.real_href =  page_url +  value.href;	
				}
				images.push({'href' : value.real_href, 'title'	: value.title , extra_href : value.href });
			});
		}
		
		
		if (location.hash.toString()){
			var file_url = location.hash.substring(1);
			if(file_url){
				$.getJSON("ufs.json?action=file_info&url=" + file_url, function(images) {
					if(!(images.error)){
						var JSON = [];
						JSON = JSON.concat(images);
						var user_image = [];
						parseArrayForBox(JSON, user_image);
						jQuery(document).ready(function() {
								showBox(user_image, 0);
						});
					}else{
					user = readCookie('session-id');
						if (user != null) {
							$(document).ready(function() {
								$(".loged-in-user-error").html('<div><p>You don\'t permission to view this image</p></div>');
								$(".loged-in-user-error").center();
							});
						}else{
							$(document).ready(function() {
								$(".not-loged-in-user-error").html('<div><p>Currently you have not enough permissions to view this image. Please log in.</p></div>');
							});
						}
				}
				});
			}
		}

	</script>
</head>
<body>
	<div class="pseudo-no-js-heaser"><br/><br/><br/></div>
			<div class="loged-in-user" >
				<a style="text-decoration:none; width:49%">
					<p id="upload_button" class="butt" style=" position:absolute;  width:49%; right:0;">
					Upload A File Now! 
					</p> 
				</a>
				
				<div class="description-box">
					<h3 class="fun">
						Image Renderer Service Welcomes You.
					</h3>
					<br/>
					<p style="text-align:left;">
						It shows you a gallery of images you uploaded with User File Service. This servise also allows us to transcode vector and rastr images of diffrent formats and perform resize operations. In future it will show you images in form of a map.
					</p>
				
				</div>

				<div id="tabs-fun" class="files-box fun" style="margin-top:24px;">
					<ol id="marx-images">
						<div data-template>
							<a rel="example_group" class="image_service_url"  href="#{{href}}" real_href="{{real_href}}" title="{{title}}"><p class="image_service_file_name">{{title}}</p></a>                         
						</div>
					</ol>
					<script>
							//$(".image_service_file_name").live('mouseup', function(eventObj){
							//		var sFromUrl = $(this).parent('.image_service_url').attr('href').match(/from_url=[^&]*/)[0];
							//		var sBasename = sFromUrl.match(/[^\/]*$/)[0];
							//	window.location.hash = sBasename;
							//});
					</script>
				</div>	
			</div>
	<script type="text/javascript">
		shuffle = function(o){ //v1.0
			for(var j, x, i = o.length; i; j = parseInt(Math.random() * i), x = o[--i], o[i] = o[j], o[j] = x);
			return o;
		};
		
		$(document).ready(function() {
			
		user = readCookie('session-id');
		if (user != null) {
			
		   var is = Tempo.prepare('marx-images');
			is.starting();
			var joinedJSON = [];
			var user_images = [];
			$.getJSON("ufs.json?action=type&type=image", function(json_image) {
				joinedJSON = joinedJSON.concat(json_image);
					$.getJSON("ufs.json?action=type&type=png", function(json_png) {
						joinedJSON = joinedJSON.concat(json_png);
							$.getJSON("ufs.json?action=type&type=jpg", function(json_jpg) {
								joinedJSON = joinedJSON.concat(json_jpg);
									$.getJSON("ufs.json?action=type&type=jpeg", function(json_jpeg) {
										joinedJSON = joinedJSON.concat(json_jpeg);
											$.getJSON("ufs.json?action=type&type=svg", function(json_svg) {
												joinedJSON = joinedJSON.concat(json_svg);
												joinedJSON = shuffle(joinedJSON);
												parseArrayForBox(joinedJSON, user_images);
												is.render(joinedJSON);

											}); // SVG	
									}); // jpeg
							}); // jpg
					}); // png
				}); // image
				
			$('.image_service_url').live('click', function( e ) {
				var temp_h =   $( e.target ).closest("a").attr('real_href');
				var ind = 0;
				$.each(user_images, function(index, value) {
					if(value.href === temp_h ) {
					   ind = index;
						return false;
					}
				});
				showBox(user_images, ind);
			});
		}
		});
	</script>
</html>